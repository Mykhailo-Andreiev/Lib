{% load static %}

<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>{{ book.title }}</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>

<style>
    .book-info p {
        font-size: 17px;
        line-height: 1.6;
    }

    .book-info {
    max-width: 100%;
    flex: 1;
}
</style>

<body class="page-book-detail">

<header class="main-header">
    <nav class="navbar">
        <div class="navbar-left">
            <a href="/" class="nav-link">–ì–æ–ª–æ–≤–Ω–∞</a>
            <a href="/books/" class="nav-link">–ö–∞—Ç–∞–ª–æ–≥</a>
            <a href="/archive/" class="nav-link">–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∏–π –∞—Ä—Ö—ñ–≤</a>
        </div>

        <div class="navbar-right">
            {% if user.is_authenticated %}
            <a href="{% url 'profile' %}" class="nav-link nav-user">üë§ {{ user.username }}</a>
            <a href="{% url 'logout' %}" class="nav-link">üö™ –í–∏–π—Ç–∏</a>

            {% else %}
            <a href="{% url 'login' %}" class="nav-link">üîë –í—Ö—ñ–¥</a>
            <a href="{% url 'register' %}" class="nav-link">üìù –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</a>
            {% endif %}
        </div>
    </nav>
</header>

<div class="container detail-container">
    <div class="book-detail">
        <div class="book-image">
            {% if book.image %}
            <img src="{{ book.image.url }}" alt="{{ book.title }}">
            {% else %}
            <img src="{% static 'img/default_cover.jpg' %}" alt="No cover">
            {% endif %}
        </div>
        <div class="book-info">
            <h1>{{ book.title }}</h1>
            <p><strong>–ê–≤—Ç–æ—Ä:</strong> {{ book.author }}</p>
            <p><strong>–ñ–∞–Ω—Ä:</strong> {{ book.genre }}</p>
            <p><strong>–ú–æ–≤–∞:</strong> {{ book.language }}</p>
            <p><strong>–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç–æ—Ä—ñ–Ω–æ–∫:</strong> {{ book.pages }}</p>
            <p><strong>–†—ñ–∫ –≤–∏–¥–∞–Ω–Ω—è:</strong> {{ book.year }}</p>
            <p><strong>–û–ø–∏—Å:</strong><br>{{ book.description }}</p>
            <p>
                {% if book.available %}
                <span class="available">‚úÖ –í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ</span>
                {% else %}
                <span class="not-available">‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–Ω–∞</span>
                {% endif %}
            </p>

            {% if user.is_authenticated and book.available %}
            <form method="post" action="{% url 'book_reserve' book.id %}">
                {% csrf_token %}
                <button type="submit" class="button reserve-button">üìö –ó–∞–±—Ä–æ–Ω—é–≤–∞—Ç–∏</button>
            </form>
            {% endif %}

            <br>
            <a href="{% url 'books' %}" class="button">‚Üê –ù–∞–∑–∞–¥ –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É</a>
        </div>
    </div>

    <hr>
    <h3>‚≠ê –†–µ–π—Ç–∏–Ω–≥ —Ç–∞ –≤—ñ–¥–≥—É–∫–∏</h3>
    <p><strong>–°–µ—Ä–µ–¥–Ω—ñ–π —Ä–µ–π—Ç–∏–Ω–≥:</strong> {{ book.average_rating }} / 5</p>

    {% if user.is_authenticated %}
    <form method="post" class="rating-form">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="button">üì© –ó–±–µ—Ä–µ–≥—Ç–∏ –æ—Ü—ñ–Ω–∫—É</button>
    </form>
    {% else %}
    <p>üîê <a href="{% url 'login' %}">–£–≤—ñ–π–¥—ñ—Ç—å</a>, —â–æ–± –∑–∞–ª–∏—à–∏—Ç–∏ –æ—Ü—ñ–Ω–∫—É —á–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä.</p>
    {% endif %}

    <hr>
    <h4>üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ:</h4>
    <ul class="comment-list">
        {% for r in ratings %}
        <li class="comment-item">
            <strong>{{ r.user.username }}</strong> ‚Äî {{ r.rating }}‚≠ê<br>
            <em>{{ r.comment }}</em><br>
            <small>{{ r.rated_at|date:"d.m.Y H:i" }}</small>
        </li>
        {% empty %}
        <li>üì≠ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ –ø–æ–∫–∏ –Ω–µ–º–∞—î.</li>
        {% endfor %}
    </ul>
</div>

</body>
</html>
