{% load static %}
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <style>
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            gap: 10px;
            flex-wrap: wrap;
        }
    </style>
</head>

<body class="page-librarian">

<header class="main-header">
    <nav class="navbar">
        <div class="navbar-left">
            <a href="/" class="nav-link">–ì–æ–ª–æ–≤–Ω–∞</a>
            <a href="/books/" class="nav-link">–ö–∞—Ç–∞–ª–æ–≥</a>
            <a href="/archive/" class="nav-link">–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∏–π –∞—Ä—Ö—ñ–≤</a>
        </div>
        <div class="navbar-right">
            {% if user.is_authenticated %}
            <a href="{% url 'profile' %}" class="nav-link nav-user">üë§ {{ user.username }}</a>
            <a href="{% url 'logout' %}" class="nav-link">üö™ –í–∏–π—Ç–∏</a>
            {% else %}
            <a href="{% url 'login' %}" class="nav-link">üîë –í—Ö—ñ–¥</a>
            <a href="{% url 'register' %}" class="nav-link">üìù –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</a>
            {% endif %}
        </div>
    </nav>
</header>

<div class="container page-librarian">
    <div class="bookings-wrapper">

        <!-- –Ü–°–¢–û–†–Ü–Ø -->
        <div class="booking-section">
            <h2>–Ü–°–¢–û–†–Ü–Ø</h2>
            <form method="get" class="archive-filter-form">
                <input type="text" name="q" placeholder="–í–≤–µ–¥—ñ—Ç—å –ª–æ–≥—ñ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–±–æ –Ω–∞–∑–≤—É –∫–Ω–∏–≥–∏..." value="{{ request.GET.q }}">
                <button type="submit">üîç –ü–æ—à—É–∫</button>
            </form>

            <ul>
                {% for booking in bookings %}
                <li>
                    <strong>{{ booking.user.username }}</strong> ‚Äî <em>{{ booking.book.title }}</em>
                    ({{ booking.get_status_display }}) | {{ booking.booking_date|date:"d.m.Y H:i" }}
                    {% if booking.status == 'active' %}
                    <a href="{% url 'issue_book' booking.id %}">‚úÖ –í–∏–¥–∞—Ç–∏</a>
                    <a href="{% url 'cancel_booking_librarian' booking.id %}">‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</a>
                    {% endif %}
                </li>
                {% empty %}
                <li>üì≠ –ù–µ–º–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤.</li>
                {% endfor %}
            </ul>

            {% if bookings.has_other_pages %}
            <div class="pagination">
                {% if bookings.has_previous %}
                <a href="?q={{ request.GET.q }}&page={{ bookings.previous_page_number }}">‚¨ÖÔ∏è –ü–æ–ø–µ—Ä–µ–¥–Ω—è</a>
                {% endif %}
                <span>{{ bookings.number }} / {{ bookings.paginator.num_pages }}</span>
                {% if bookings.has_next %}
                <a href="?q={{ request.GET.q }}&page={{ bookings.next_page_number }}">‚û°Ô∏è –ù–∞—Å—Ç—É–ø–Ω–∞</a>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <!-- –í–ò–î–ê–ù–Ü –ö–ù–ò–ì–ò -->
        <div class="issued-section">
            <h2>–í–ò–î–ê–ù–Ü –ö–ù–ò–ì–ò</h2>
            <form method="get" class="archive-filter-form">
                <input type="text" name="iq" placeholder="–í–≤–µ–¥—ñ—Ç—å –ª–æ–≥—ñ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–±–æ –Ω–∞–∑–≤—É –∫–Ω–∏–≥–∏..." value="{{ request.GET.iq }}">
                <button type="submit">üîç –ü–æ—à—É–∫</button>
            </form>

            <ul>
                {% for issued in issued_books %}
                <li>
                    <strong>{{ issued.user.username }}</strong> ‚Äî <em>{{ issued.book.title }}</em>
                    (–≤–∏–¥–∞–Ω–æ {{ issued.issue_date|date:"d.m.Y H:i" }})
                    <a href="{% url 'return_book' issued.id %}">üì• –ü–æ–≤–µ—Ä–Ω—É—Ç–∏</a>
                </li>
                {% empty %}
                <li>üì≠ –ù–µ–º–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤.</li>
                {% endfor %}
            </ul>

            {% if issued_books.has_other_pages %}
            <div class="pagination">
                {% if issued_books.has_previous %}
                <a href="?iq={{ request.GET.iq }}&ipage={{ issued_books.previous_page_number }}">‚¨ÖÔ∏è –ü–æ–ø–µ—Ä–µ–¥–Ω—è</a>
                {% endif %}
                <span>{{ issued_books.number }} / {{ issued_books.paginator.num_pages }}</span>
                {% if issued_books.has_next %}
                <a href="?iq={{ request.GET.iq }}&ipage={{ issued_books.next_page_number }}">‚û°Ô∏è –ù–∞—Å—Ç—É–ø–Ω–∞</a>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <!-- –°–¢–í–û–†–ï–ù–ù–Ø –ó–ê–ú–û–í–õ–ï–ù–ù–Ø -->
        <div class="manual-issue-section">
            <h2>–°–¢–í–û–†–ï–ù–ù–Ø –ó–ê–ú–û–í–õ–ï–ù–ù–Ø</h2>
            <form method="post" class="manual-issue-form">
                {% csrf_token %}
                <div class="form-group">
                    <label for="book_title">–ù–∞–∑–≤–∞ –∫–Ω–∏–≥–∏:</label>
                    <input type="text" name="book_title" id="book_title" list="book_list" class="dark-input" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∫–Ω–∏–≥–∏..." required>
                    <datalist id="book_list">
                        {% for book in books %}
                        <option value="{{ book.title }}">
                            {% endfor %}
                    </datalist>
                </div>

                <div class="form-group">
                    <label for="user_name">–Ü–º‚Äô—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–ª–æ–≥—ñ–Ω):</label>
                    <input type="text" name="user_name" id="user_name" list="user_list" class="dark-input" placeholder="–í–≤–µ–¥—ñ—Ç—å –ª–æ–≥—ñ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞..." required>
                    <datalist id="user_list">
                        {% for user in users %}
                        <option value="{{ user.username }}">
                            {% endfor %}
                    </datalist>
                </div>

                <button type="submit" class="librarian-button">üì§ –í–∏–¥–∞—Ç–∏ –∫–Ω–∏–≥—É</button>
            </form>
        </div>
    </div>
</div>

</body>
</html>
